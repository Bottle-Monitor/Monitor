# 🧪 前后端联调测试指南

本文档详细说明如何测试监控SDK的前后端联调功能，确保测试数据能够正确上报到后端并在统计页面展示。

## 📋 前置条件

### 1. 启动后端服务器
```bash
cd apps/server
npm install
npm start
```

确保服务器在 `http://localhost:3000` 上运行。

### 2. 启动前端应用
```bash
cd apps/demo
npm install
npm run dev
```

确保前端应用在 `http://localhost:5173` 上运行。

## 🔗 连接状态检查

### 1. 服务器状态指示器
在每个测试页面的顶部，你会看到服务器连接状态指示器：
- 🟢 **已连接**：表示前端能够成功连接到后端服务器
- 🔴 **未连接**：表示前端无法连接到后端服务器

### 2. 手动测试连接
点击 **"测试连接"** 按钮来手动检查服务器连接状态。

## 📊 测试数据流程

### 1. 用户行为测试
1. 进入 **用户行为测试页面**
2. 确保服务器状态显示为 **"已连接"**
3. 点击 **"开始记录"** 按钮
4. 执行各种测试操作（点击、页面访问、路由变化等）
5. 点击 **"停止记录"** 按钮
6. 点击 **"同步数据"** 按钮将数据同步到服务器

### 2. 性能测试
1. 进入 **性能测试页面**
2. 确保服务器状态显示为 **"已连接"**
3. 执行各种性能测试（长任务、内存泄漏、网络延迟等）
4. 测试完成后点击 **"同步数据"** 按钮

### 3. 错误测试
1. 进入 **错误测试页面**
2. 确保服务器状态显示为 **"已连接"**
3. 触发各种类型的错误（JavaScript错误、Promise错误、资源加载错误等）
4. 错误会自动上报到后端服务器

## 📈 数据验证

### 1. 实时统计
在每个测试页面，你可以看到：
- **本地记录**：当前页面记录的事件数量
- **服务器状态**：与后端的连接状态
- **服务器统计**：后端接收到的总事件数量

### 2. 查看统计页面
测试完成后，进入以下页面查看数据：
- **用户行为页面**：查看所有用户行为数据统计
- **性能监控页面**：查看性能指标统计
- **错误监控页面**：查看错误统计信息
- **仪表盘**：查看综合统计数据

### 3. 后端数据验证
在浏览器控制台中，你可以看到：
- 数据上报的详细日志
- 服务器响应的状态
- 连接重试的尝试次数

## 🚨 常见问题排查

### 1. 连接失败
**症状**：服务器状态显示为 **"未连接"**

**排查步骤**：
1. 检查后端服务器是否正在运行
2. 确认服务器端口是否正确（默认3000）
3. 检查浏览器控制台是否有网络错误
4. 尝试手动点击 **"测试连接"** 按钮

**解决方案**：
```bash
# 重启后端服务器
cd apps/server
npm start

# 检查端口占用
netstat -an | findstr :3000
```

### 2. 数据未同步
**症状**：本地记录了事件，但服务器统计没有增加

**排查步骤**：
1. 确认服务器连接状态为 **"已连接"**
2. 检查浏览器控制台是否有上报错误
3. 手动点击 **"同步数据"** 按钮
4. 检查后端服务器日志

**解决方案**：
```bash
# 检查后端日志
cd apps/server
npm start

# 在另一个终端查看日志输出
```

### 3. 测试数据不显示
**症状**：测试完成后，统计页面没有显示新数据

**排查步骤**：
1. 确认数据已成功上报到后端
2. 检查统计页面的刷新间隔
3. 手动刷新统计页面
4. 检查数据过滤条件

**解决方案**：
- 等待页面自动刷新（通常10秒）
- 手动刷新页面
- 检查数据的时间范围设置

## 🔧 调试技巧

### 1. 浏览器开发者工具
- **Console**：查看数据上报日志和错误信息
- **Network**：监控API请求和响应
- **Application**：检查本地存储和缓存

### 2. 后端日志
```bash
# 查看服务器日志
cd apps/server
npm start

# 日志会显示：
# - 接收到的监控数据
# - 数据统计更新
# - 错误信息
```

### 3. 数据验证
```javascript
// 在浏览器控制台中验证数据
// 检查监控实例
console.log(getBottleMonitor())

// 检查连接状态
console.log(monitoringService.getConnectionStatus())

// 手动获取统计信息
monitoringService.getStats().then(console.log)
```

## 📝 测试检查清单

- [ ] 后端服务器正在运行
- [ ] 前端应用能够访问
- [ ] 服务器状态显示为 **"已连接"**
- [ ] 能够开始记录测试数据
- [ ] 测试数据能够成功上报
- [ ] 统计页面能够显示新数据
- [ ] 数据同步功能正常工作

## 🎯 成功标准

前后端联调成功的标志：
1. **连接稳定**：服务器状态持续显示为 **"已连接"**
2. **数据上报**：测试事件能够实时上报到后端
3. **统计同步**：前端统计页面能够显示后端数据
4. **错误处理**：网络异常时能够自动重连
5. **性能良好**：数据上报和查询响应时间在可接受范围内

## 📞 技术支持

如果遇到问题，请：
1. 检查本文档的常见问题排查部分
2. 查看浏览器控制台的错误信息
3. 检查后端服务器的运行日志
4. 确认网络连接和防火墙设置

---

**注意**：本测试指南假设你已经在本地环境中正确设置了项目。如果遇到环境配置问题，请参考项目的 `SETUP.md` 文档。
