# 🚀 Bottle Monitor 前后端联调设置

## 📋 问题总结

经过检查，发现前后端联调存在以下问题：

### ❌ 原始问题
1. **API端点不匹配**: 前端SDK配置 `dsnURL: 'http://localhost:3000/monitor'`，但后端接口是 `/report`
2. **代理配置未使用**: 前端配置了Vite代理，但SDK直接访问后端
3. **连接状态检查**: 前端服务直接访问后端，绕过了代理配置

### ✅ 已修复
1. **统一API路径**: 前端SDK使用 `/api/report`，通过Vite代理转发
2. **服务层配置**: 监控服务使用 `/api` 前缀，统一通过代理访问
3. **添加连接测试**: 在页面加载时自动测试前后端连接

## 🔧 启动步骤

### 方法1: 使用启动脚本（推荐）
```bash
# Windows
start-dev.bat

# Linux/Mac
./start-dev.sh
```

### 方法2: 手动启动
```bash
# 1. 启动后端服务器
cd apps/server
npm install
npm start

# 2. 启动前端应用（新终端）
cd apps/demo
npm install
npm run dev
```

## 🌐 访问地址

- **前端应用**: http://localhost:5173
- **后端API**: http://localhost:3000
- **代理API**: http://localhost:5173/api/*

## 🧪 连接测试

页面加载后会自动执行连接测试，检查控制台输出：

```
🧪 测试前后端连接...

1️⃣ 测试后端直接连接...
✅ 后端直接连接成功: {status: 200, data: {...}}

2️⃣ 测试前端代理连接...
✅ 前端代理连接成功: {status: 200, data: {...}}

3️⃣ 测试监控数据上报...
✅ 监控数据上报成功: {status: 200, message: "监控数据接收成功", ...}
```

## 📊 数据流程

```
前端SDK → /api/report → Vite代理 → 后端/report → 数据存储
前端服务 → /api/* → Vite代理 → 后端接口 → 数据返回
```

## 🔍 故障排除

### 常见问题

1. **后端启动失败**
   - 检查端口3000是否被占用
   - 确认Node.js版本 >= 16
   - 检查依赖是否正确安装

2. **前端无法连接后端**
   - 确认后端服务器已启动
   - 检查控制台网络请求
   - 验证代理配置是否正确

3. **监控数据不显示**
   - 检查SDK初始化状态
   - 确认数据上报成功
   - 查看后端数据存储

### 调试技巧

- 使用浏览器开发者工具查看网络请求
- 检查控制台错误信息
- 验证API接口响应状态
- 确认数据格式正确性

## 📝 配置说明

### 前端配置
- **Vite代理**: `/api` → `http://localhost:3000`
- **SDK配置**: `dsnURL: '/api/report'`
- **服务配置**: `baseURL: '/api'`

### 后端配置
- **端口**: 3000
- **CORS**: 已启用
- **接口**: `/report`, `/data`, `/stats`

## 🎯 下一步

前后端联调问题已修复，现在可以：

1. 启动开发环境
2. 测试监控功能
3. 验证数据上报
4. 检查实时监控面板

如有问题，请检查控制台输出和网络请求状态。
